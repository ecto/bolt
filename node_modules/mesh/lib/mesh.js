/*
 * Mesh client
 * Cam Pedersen
 * Sept 8, 2011
 */

var net    = require('net'),
    events = require('events');

(function(){
  var mesh = {},
      ee   = new events.EventEmitter(),
      c;

  module.exports = mesh;

  mesh.connect = function(host, port){
    host = host || '127.0.0.1',
    port = port || '1234',
    c = net.createConnection(port, host);
    c.on('connect', connected);
    c.on('data', incoming);
    c.on('end', disconnected);
    return mesh;
  }

  mesh.on = function(hook, callback){
    return ee.on(hook, callback);
  }

  mesh.emit = function(hook, callback){
    // send the emission to the mesh server
    return ee.emit(hook, callback);
  }

  var connected = function(){
    console.log(arguments);
  };

  var incoming = function(){
    console.log(arguments);
  };

  var disconnected = function(){
    console.log('disconnected');
  }

  process.on('uncaughtException', function(){
    console.log(arguments);
  });

})();

